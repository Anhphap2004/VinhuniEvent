@model List<VinhuniEvent.Models.User>

@{
    ViewData["Title"] = "Quản lý sinh viên";
}

<style>
    .page-header {
        padding: 1.5rem 0;
        margin-bottom: 1.5rem;
        border-bottom: 2px solid #2a5298;
    }

    .page-title {
        color: #2a5298;
        font-size: 1.5rem;
        font-weight: 600;
        margin: 0 0 0.3rem 0;
    }

    .page-description {
        color: #6c757d;
        font-size: 0.9rem;
        margin: 0;
    }

    .filter-box {
        border: 1px solid #ddd;
        padding: 1.5rem;
        margin-bottom: 1.5rem;
    }

    .filter-label {
        font-weight: 600;
        font-size: 0.85rem;
        color: #495057;
        margin-bottom: 0.5rem;
    }

    .search-input {
        border: 1px solid #ddd;
        padding: 0.5rem 0.75rem;
        font-size: 0.9rem;
    }

        .search-input:focus {
            border-color: #2a5298;
            outline: none;
            box-shadow: none;
        }

    .btn-reset {
        background: white;
        color: #495057;
        border: 1px solid #ddd;
        padding: 0.5rem 1rem;
        font-size: 0.9rem;
    }

        .btn-reset:hover {
            background: #f8f9fa;
            color: #495057;
            border-color: #ddd;
        }

    .custom-table {
        margin: 0;
        border: 1px solid #dee2e6;
    }

        .custom-table thead th {
            background: #f8f9fa;
            color: #495057;
            font-weight: 600;
            font-size: 0.85rem;
            text-transform: uppercase;
            padding: 0.75rem;
            border-bottom: 2px solid #dee2e6;
        }

        .custom-table tbody td {
            padding: 0.75rem;
            vertical-align: middle;
            font-size: 0.9rem;
        }

        .custom-table tbody tr:hover {
            background: #f8f9fa;
        }

    .avatar-circle {
        width: 36px;
        height: 36px;
        border-radius: 50%;
        background: #e3f2fd;
        color: #1976d2;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
        font-size: 0.9rem;
        margin-right: 0.75rem;
    }

    .badge-active {
        background: #d4edda;
        color: #155724;
        padding: 0.25rem 0.6rem;
        border-radius: 4px;
        font-size: 0.8rem;
    }

    .badge-inactive {
        background: #f8d7da;
        color: #721c24;
        padding: 0.25rem 0.6rem;
        border-radius: 4px;
        font-size: 0.8rem;
    }

    .action-btn {
        padding: 0.3rem 0.6rem;
        font-size: 0.8rem;
        text-decoration: none;
        color: #0d6efd;
        border: 1px solid #0d6efd;
    }

        .action-btn:hover {
            background: #0d6efd;
            color: white;
        }

    .no-result {
        text-align: center;
        padding: 3rem;
        color: #6c757d;
        display: none;
    }
</style>

<div class="container-fluid px-4">
    <!-- Header -->
    <div class="page-header">
        <h1 class="page-title">Quản lý sinh viên</h1>
        <p class="page-description">Danh sách và thông tin chi tiết của tất cả sinh viên trong hệ thống.</p>
    </div>

    <!-- Filter Box -->
    <div class="filter-box">
        <div class="row g-3 align-items-end">
            <div class="col-md-5">
                <label class="filter-label">Tìm theo Tên</label>
                <input type="text" id="searchName" class="form-control search-input"
                       placeholder="Nhập họ tên sinh viên..." onkeyup="filterTable()">
            </div>
            <div class="col-md-4">
                <label class="filter-label">Tìm theo MSSV</label>
                <input type="text" id="searchCode" class="form-control search-input"
                       placeholder="Nhập mã số sinh viên..." onkeyup="filterTable()">
            </div>
            <div class="col-md-3">
                <button onclick="resetFilters()" class="btn btn-reset w-100">
                    Xóa bộ lọc
                </button>
            </div>
        </div>
    </div>

    <!-- Table -->
    <div class="table-responsive">
        <table class="table custom-table" id="studentsTable">
            <thead>
                <tr>
                    <th>Họ tên</th>
                    <th>Mã SV</th>
                    <th>Khoa / Ngành</th>
                    <th>Liên hệ</th>
                    <th class="text-center">Trạng thái</th>
                    <th class="text-center">Hành động</th>
                </tr>
            </thead>
            <tbody id="tableBody">
                @foreach (var s in Model)
                {
                    <tr>
                        <td>
                            <div class="d-flex align-items-center">
                                <div class="avatar-circle">
                                    @s.FullName?.FirstOrDefault()
                                </div>
                                <span class="fw-bold user-name">@s.FullName</span>
                            </div>
                        </td>
                        <td class="fw-bold text-secondary user-code">@s.StudentCode</td>
                        <td>
                            <small class="d-block text-muted">Khoa: @s.Faculty</small>
                            <span class="fw-bold">@s.Major</span>
                        </td>
                        <td>@s.Email</td>
                        <td class="text-center">
                            @if (s.IsActive == true)
                            {
                                <span class="badge-active">Hoạt động</span>
                            }
                            else
                            {
                                <span class="badge-inactive">Khóa</span>
                            }
                        </td>
                        <td class="text-center">
                            <a asp-action="Details" asp-route-id="@s.UserId" class="action-btn">
                                Xem
                            </a>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
        <div id="noResult" class="no-result">
            <p>Không tìm thấy sinh viên nào khớp với từ khóa.</p>
        </div>
    </div>
</div>

<script>
    function filterTable() {
        var inputName = document.getElementById("searchName").value.toLowerCase();
        var inputCode = document.getElementById("searchCode").value.toLowerCase();
        var tableBody = document.getElementById("tableBody");
        var rows = tableBody.getElementsByTagName("tr");
        var hasResult = false;

        for (var i = 0; i < rows.length; i++) {
            var nameCol = rows[i].getElementsByTagName("td")[0].textContent || rows[i].getElementsByTagName("td")[0].innerText;
            var codeCol = rows[i].getElementsByTagName("td")[1].textContent || rows[i].getElementsByTagName("td")[1].innerText;
            if (nameCol.toLowerCase().indexOf(inputName) > -1 && codeCol.toLowerCase().indexOf(inputCode) > -1) {
                rows[i].style.display = "";
                hasResult = true;
            } else {
                rows[i].style.display = "none";
            }
        }

        var noResultDiv = document.getElementById("noResult");
        if (!hasResult) {
            noResultDiv.style.display = "block";
        } else {
            noResultDiv.style.display = "none";
        }
    }

    function resetFilters() {
        document.getElementById("searchName").value = "";
        document.getElementById("searchCode").value = "";
        filterTable();
    }
</script>